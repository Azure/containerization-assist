#!/bin/sh

# Exit codes for better debugging
readonly EXIT_LINT_STAGED_FAILED=1
readonly EXIT_EXAMPLES_FAILED=2

# Enable strict error handling
set -eu

# Main execution
main() {
    echo "🛡️ Running pre-commit checks..."

    # Run lint-staged (handles linting and formatting for staged files only)
    echo "🔍 Running lint-staged checks..."
    if ! npx lint-staged; then
        echo "❌ Lint-staged checks failed"
        exit $EXIT_LINT_STAGED_FAILED
    fi

    # Validate TypeScript examples
    echo "📚 Validating TypeScript examples..."
    if ! node scripts/validate-examples.js; then
        echo "❌ Examples validation failed"
        exit $EXIT_EXAMPLES_FAILED
    fi

    echo "✅ Pre-commit checks passed!"
}

# Run main function
main "$@"