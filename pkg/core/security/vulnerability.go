// Package security provides shared vulnerability types and interfaces
package security

// Vulnerability represents a single vulnerability finding
type Vulnerability struct {
	VulnerabilityID  string            `json:"vulnerability_id"`
	PkgName          string            `json:"pkg_name"`
	PkgID            string            `json:"pkg_id,omitempty"`
	PkgType          string            `json:"pkg_type,omitempty"`
	PkgPath          string            `json:"pkg_path,omitempty"`
	InstalledVersion string            `json:"installed_version"`
	FixedVersion     string            `json:"fixed_version"`
	Severity         string            `json:"severity"` // CRITICAL, HIGH, MEDIUM, LOW, UNKNOWN
	Title            string            `json:"title"`
	Description      string            `json:"description"`
	References       []string          `json:"references"`
	Layer            string            `json:"layer,omitempty"`
	CVSS             CVSSInfo          `json:"cvss,omitempty"`
	CWE              []string          `json:"cwe,omitempty"`
	PublishedDate    string            `json:"published_date,omitempty"`
	LastModifiedDate string            `json:"last_modified_date,omitempty"`
	DataSource       VulnDataSource    `json:"data_source,omitempty"`
	PrimaryURL       string            `json:"primary_url,omitempty"`
	VendorSeverity   map[string]string `json:"vendor_severity,omitempty"`
	CVSSV3           CVSSV3Info        `json:"cvss_v3,omitempty"`
	Status           string            `json:"status,omitempty"`
	PkgIdentifier    PkgIdentifier     `json:"pkg_identifier,omitempty"`
}

// CVSSInfo contains CVSS scoring information
type CVSSInfo struct {
	Version string  `json:"version,omitempty"`
	Vector  string  `json:"vector,omitempty"`
	Score   float64 `json:"score,omitempty"`
}

// CVSSV3Info contains detailed CVSS v3 information
type CVSSV3Info struct {
	Vector                string  `json:"vector,omitempty"`
	Score                 float64 `json:"score,omitempty"`
	ExploitabilityScore   float64 `json:"exploitability_score,omitempty"`
	ImpactScore           float64 `json:"impact_score,omitempty"`
	AttackVector          string  `json:"attack_vector,omitempty"`
	AttackComplexity      string  `json:"attack_complexity,omitempty"`
	PrivilegesRequired    string  `json:"privileges_required,omitempty"`
	UserInteraction       string  `json:"user_interaction,omitempty"`
	Scope                 string  `json:"scope,omitempty"`
	ConfidentialityImpact string  `json:"confidentiality_impact,omitempty"`
	IntegrityImpact       string  `json:"integrity_impact,omitempty"`
	AvailabilityImpact    string  `json:"availability_impact,omitempty"`
}

// VulnDataSource contains information about vulnerability data sources
type VulnDataSource struct {
	ID   string `json:"id,omitempty"`
	Name string `json:"name,omitempty"`
	URL  string `json:"url,omitempty"`
}

// PkgIdentifier contains package identification information
type PkgIdentifier struct {
	PURL      string            `json:"purl,omitempty"`
	UID       string            `json:"uid,omitempty"`
	BomRef    string            `json:"bom_ref,omitempty"`
	Licenses  []string          `json:"licenses,omitempty"`
	Locations []PkgLocation     `json:"locations,omitempty"`
	Metadata  map[string]string `json:"metadata,omitempty"`
}

// PkgLocation represents where a package is located
type PkgLocation struct {
	StartLine int    `json:"start_line,omitempty"`
	EndLine   int    `json:"end_line,omitempty"`
	Path      string `json:"path"`
}

// VulnerabilitySummary provides a summary of scan findings
type VulnerabilitySummary struct {
	Total    int `json:"total"`
	Critical int `json:"critical"`
	High     int `json:"high"`
	Medium   int `json:"medium"`
	Low      int `json:"low"`
	Unknown  int `json:"unknown"`
	Fixable  int `json:"fixable"`
}

// RemediationStep provides guidance on fixing vulnerabilities
type RemediationStep struct {
	Priority    int    `json:"priority"`
	Action      string `json:"action"`
	Description string `json:"description"`
	Command     string `json:"command,omitempty"`
}
