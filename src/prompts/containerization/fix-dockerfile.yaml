id: fix-dockerfile
version: '1.0.0'
description: Fix issues in an existing Dockerfile based on analysis and error context
category: containerization
parameters:
  - name: dockerfileContent
    type: string
    required: true
    description: Current Dockerfile content to fix
  - name: errors
    type: array
    required: false
    description: Array of specific errors to address
  - name: buildError
    type: string
    required: false
    description: Build error message that occurred
  - name: language
    type: string
    required: false
    description: Programming language of the application
  - name: framework
    type: string
    required: false
    description: Framework used by the application
  - name: frameworkVersion
    type: string
    required: false
    description: Version of the framework being used
  - name: analysis
    type: string
    required: false
    description: Repository analysis context
  - name: bestPractices
    type: array
    required: false
    description: Knowledge-base best practices recommendations
  - name: examples
    type: array
    required: false
    description: Relevant code examples from knowledge base
  - name: securityRecommendations
    type: array
    required: false
    description: Security-specific recommendations from knowledge base
  - name: knowledgeSuggestions
    type: array
    required: false
    description: Detailed suggestions with reasons from knowledge base
template: |
  Fix the provided Dockerfile to resolve build issues and improve best practices.

  Current Dockerfile:
  {{dockerfileContent}}


  Build Error:
  {{buildError}}



  Specific Issues to Fix:
  {{#each errors}}
  - {{this}}
  {{/each}}



  Language: {{language}}



  Framework: {{framework}}



  Framework Version: {{frameworkVersion}}



  Repository Context:
  {{analysis}}


  Best Practices (from knowledge base):
  {{#.}}- {{.}}
  {{/.}}

  Relevant Examples:
  {{#.}}- {{.}}
  {{/.}}

  Security Recommendations:
  {{#.}}- {{.}}
  {{/.}}

  Knowledge-Based Suggestions:
  {{#.}}- {{recommendation}} ({{reason}})
  {{/.}}

  Requirements:
  1. Fix any syntax errors and build failures
  2. Apply containerization best practices
  {{#.}}3. {{.}}
  {{/.}}
  3. Ensure proper build caching and layer optimization
  4. Use security best practices (non-root user, minimal packages)
  {{#.}}   - {{.}}
  {{/.}}
  5. Optimize for image size where possible
  6. Maintain the original functionality and intent
  {{#.}}7. Consider: {{recommendation}} ({{reason}})
  {{/.}}

  Return only the corrected Dockerfile content without explanation or code fences.
format: text
